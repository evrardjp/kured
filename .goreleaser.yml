project_name: kured
before:
  hooks:
    - go mod tidy
builds:
  - id: "kured"
    main: ./cmd/kured
    binary: kured
    env:
      - CGO_ENABLED=0
    goos:
      - linux
    goarch:
      - amd64
      - arm64
    goarm:
      - "6"
      - "7"
    ldflags:
      - -s -w -X main.version={{ if .IsSnapshot }}{{ .ShortCommit }}{{ else }}{{ .Version }}{{ end }}
    mod_timestamp: "{{ .CommitTimestamp }}"
    flags:
      - -trimpath

  - id: "node-reboot-detector"
    main: ./cmd/node-reboot-detector
    binary: node-reboot-detector
    env:
      - CGO_ENABLED=0
    goos:
      - linux
    goarch:
      - amd64
      - arm64
    goarm:
      - "6"
      - "7"
    ldflags:
      - -s -w -X main.version={{ if .IsSnapshot }}{{ .ShortCommit }}{{ else }}{{ .Version }}{{ end }}
    mod_timestamp: "{{ .CommitTimestamp }}"
    flags:
      - -trimpath

  - id: "node-reboot-reporter"
    main: ./cmd/node-reboot-reporter
    binary: node-reboot-reporter
    env:
      - CGO_ENABLED=0
    goos:
      - linux
    goarch:
      - amd64
      - arm64
    goarm:
      - "6"
      - "7"
    ldflags:
      - -s -w -X main.version={{ if .IsSnapshot }}{{ .ShortCommit }}{{ else }}{{ .Version }}{{ end }}
    mod_timestamp: "{{ .CommitTimestamp }}"
    flags:
      - -trimpath

  - id: "node-maintenance-scheduler"
    main: ./cmd/node-maintenance-scheduler
    binary: node-maintenance-scheduler
    env:
      - CGO_ENABLED=0
    goos:
      - linux
    goarch:
      - amd64
      - arm64
    goarm:
      - "6"
      - "7"
    ldflags:
      - -s -w -X main.version={{ if .IsSnapshot }}{{ .ShortCommit }}{{ else }}{{ .Version }}{{ end }}
    mod_timestamp: "{{ .CommitTimestamp }}"
    flags:
      - -trimpath

snapshot:
  name_template: "{{ .ShortCommit }}"

release:
  disable: true

changelog:
  disable: true

dockers_v2:
  - id: "node-reboot-detector-img"
    ids:
      - node-reboot-detector
    images:
      - "ghcr.io/{{ .Env.DH_ORG }}/node-reboot-detector"
    platforms:
      - linux/amd64
      - linux/arm64
    tags:
      - "v{{ .Version }}"
      - "{{ if .IsSnapshot }}{{ .ShortCommit }}{{ end }}"
      - "{{ if not .IsSnapshot }}{{ .Version }}{{ end }}"

    build_flag_templates:
      - --label=org.opencontainers.image.created={{ .Date }}
      - --label=org.opencontainers.image.name={{ .ProjectName }}
      - --label=org.opencontainers.image.revision={{ .FullCommit }}
      - --label=org.opencontainers.image.version={{ .Version }}
